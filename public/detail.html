<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°</title>
    <style>
      /* --- Global Reset and Base --- */
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background: #f7f9fc; /* ë” ë°ê³  ë¶€ë“œëŸ¬ìš´ ë°°ê²½ */
        color: #333;
        line-height: 1.6;
        min-height: 100vh; /* ë·°í¬íŠ¸ ì „ì²´ ë†’ì´ë¥¼ ì‚¬ìš© */
        display: flex; /* Flexbox í™œì„±í™” */
        flex-direction: column; /* ìì‹ ìš”ì†Œ(navbar, container)ë¥¼ ìˆ˜ì§ìœ¼ë¡œ ì •ë ¬ */
      }

      /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” */
      .navbar {
        background: #007bff; /* ì „ë¬¸ì ì¸ ë¸”ë£¨ */
        color: #fff;
        padding: 15px 5%; /* % ë‹¨ìœ„ íŒ¨ë”© ì‚¬ìš© */
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* ê¹Šì€ ê·¸ë¦¼ì */
      }
      .nav-left {
        display: flex;
        gap: 30px;
      }
      .nav-left a {
        color: white;
        text-decoration: none;
        font-size: 16px;
        font-weight: 500;
        transition: color 0.3s ease;
      }
      .nav-left a:hover {
        color: #c0deff;
      }
      .logout-btn {
        color: white;
        cursor: pointer;
        font-size: 14px;
        padding: 8px 15px;
        border: 1px solid rgba(255, 255, 255, 0.5);
        border-radius: 6px;
        transition: background 0.3s ease, border-color 0.3s ease;
      }
      .logout-btn:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.8);
      }

      /* --- Detail Container and Post Card --- */
      .container {
        max-width: 90%;
        width: 900px;
        margin: 60px auto;
        flex: 1; /* ë‚¨ì€ ìˆ˜ì§ ê³µê°„ì„ ëª¨ë‘ ì°¨ì§€í•˜ë„ë¡ ì„¤ì • */
        display: flex; /* ë‚´ë¶€ ìš”ì†Œ ì •ë ¬ì„ ìœ„í•´ Flexbox ì‚¬ìš© */
        flex-direction: column;
        padding: 0 0 60px; /* ë²„íŠ¼ì´ ë„ˆë¬´ ë¶™ì§€ ì•Šë„ë¡ í•˜ë‹¨ íŒ¨ë”© í™•ë³´ */
      }

      .post-card {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        padding: 30px;
        display: flex;
        flex-direction: column;
        /* ğŸ”¥ í•µì‹¬ ìˆ˜ì •: ë‚¨ì€ ê³µê°„ì„ ëª¨ë‘ ì°¨ì§€í•˜ì—¬ .btn-groupì„ ì•„ë˜ë¡œ ë°€ì–´ëƒ…ë‹ˆë‹¤. */
        flex: 1;
        gap: 30px;
        border: 1px solid #e2e8f0;
      }

      .post-title {
        font-size: 2rem; /* ìƒëŒ€ì  í¬ê¸° */
        font-weight: 700;
        color: #007bff;
        border-bottom: 3px solid #007bff;
        padding-bottom: 15px;
        margin-bottom: 0;
      }

      .post-content {
        font-size: 1.1rem;
        color: #475569;
        line-height: 1.8;
        white-space: pre-line;
        border-radius: 8px;
        padding: 15px;
        background-color: #f8fafc; /* ë‚´ìš© ì˜ì—­ ë°°ê²½ìƒ‰ */
      }

      /* --- Button Group --- */
      .btn-group {
        /* ğŸ”¥ í•µì‹¬ ìˆ˜ì •: margin-top: autoë¡œ ì„¤ì •í•˜ì—¬ ë²„íŠ¼ì„ .post-cardì˜ ê°€ì¥ ì•„ë˜ë¡œ ë³´ëƒ…ë‹ˆë‹¤. */
        margin-top: auto;
        padding-top: 20px; /* ë‚´ìš©ê³¼ ë²„íŠ¼ ì‚¬ì´ì— ì¶”ê°€ì ì¸ ì—¬ë°± */
        display: flex;
        gap: 15px;
        justify-content: flex-end;
      }

      .btn {
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        flex-grow: 0; /* ë²„íŠ¼ í¬ê¸° ìœ ì§€ */
      }

      .edit-btn {
        background: #10b981; /* ì—ë©”ë„ë“œ ê·¸ë¦° */
        color: white;
      }

      .delete-btn {
        background: #ef4444; /* ê°•ë ¬í•œ ë ˆë“œ */
        color: white;
      }

      .edit-btn:hover {
        background: #059669;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
      }

      .delete-btn:hover {
        background: #dc2626;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);
      }

      /* --- Mobile Optimization (Responsive Design) --- */
      @media (max-width: 768px) {
        .navbar {
          padding: 15px 5%;
        }
        .container {
          max-width: 95%; /* ëª¨ë°”ì¼ì—ì„œ ë” ë„“ê²Œ ì‚¬ìš© */
          margin: 30px auto;
          padding: 20px;
        }
        .post-card {
          padding: 15px;
        }
        .post-title {
          font-size: 1.5rem;
        }
        .post-content {
          font-size: 1rem;
        }
        .btn-group {
          flex-direction: column; /* ì‘ì€ í™”ë©´ì—ì„œ ë²„íŠ¼ ì„¸ë¡œ ì •ë ¬ */
          gap: 15px; /* ì‘ì€ í™”ë©´ì—ì„œë„ ë²„íŠ¼ ì‚¬ì´ ê°„ê²© ì¦ê°€ */
          margin-top: 35px; /* ì‘ì€ í™”ë©´ ì—¬ë°± ì¦ê°€ */
        }
        .btn {
          flex: 1; /* ë²„íŠ¼ì´ ì „ì²´ ë„ˆë¹„ë¥¼ ì°¨ì§€í•˜ë„ë¡ */
          padding: 15px;
        }
      }
    </style>
  </head>
  <body>
    <header id="header">
      <div class="navbar">
        <div class="nav-left">
          <a href="main.html">ê²Œì‹œíŒ</a>
          <a href="write.html">ì‘ì„±í•˜ê¸°</a>
        </div>

        <div class="logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</div>
      </div>
    </header>

    <div class="container">
      <div id="postTitle" class="title post-title"></div>
      <div id="postContent" class="content post-content"></div>

      <div class="btn-group">
        <button class="btn edit-btn" id="editBtn">ìˆ˜ì •í•˜ê¸°</button>
        <button class="btn delete-btn" id="deleteBtn">ì‚­ì œí•˜ê¸°</button>
      </div>
    </div>
    <script>
      document
        .getElementById("logoutBtn")
        .addEventListener("click", async () => {
          try {
            const res = await fetch("http://127.0.0.1:8080/auth/logout", {
              method: "POST",
            });
            if (res.ok) {
              document.getElementById("header").remove();
              localStorage.removeItem("token");
              window.location.href = "login.html";
            } else {
              alert("ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨");
            }
          } catch (err) {
            console.error(err);
            alert("ì„œë²„ ì˜¤ë¥˜");
          }
        });

      const urlParams = new URLSearchParams(window.location.search);
      const postId = urlParams.get("id"); // URL: detail.html?id=10
      const postUserId = urlParams.get("userid");
      const token = localStorage.getItem("token");

      // JWT ë””ì½”ë”© í•¨ìˆ˜
      function decodeToken(token) {
        try {
          const payload = token.split(".")[1];
          const base64 = payload.replace(/-/g, "+").replace(/_/g, "/");
          const decoded = decodeURIComponent(
            atob(base64)
              .split("")
              .map((c) => "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2))
              .join("")
          );
          return JSON.parse(decoded);
        } catch (e) {
          console.log("decode error:", e);
          return null;
        }
      }
      const myInfo = token ? decodeToken(token) : null;

      async function loadDetail() {
        try {
          const res = await fetch(`http://127.0.0.1:8080/posts/${postId}`);
          const post = await res.json();

          document.getElementById("postTitle").textContent = post.textTitle;
          document.getElementById("postContent").textContent = post.text;

          // ğŸ”¥ ë¡œê·¸ì¸í•œ ì‚¬ëŒê³¼ ê²Œì‹œê¸€ ì‘ì„±ì ë¹„êµ
          if (!myInfo || myInfo.userid !== post.userid) {
            document.getElementById("editBtn").style.display = "none";
            document.getElementById("deleteBtn").style.display = "none";
          }
        } catch (err) {
          console.error(err);
          alert("ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì‚­ì œí•˜ê¸°
      document
        .getElementById("deleteBtn")
        .addEventListener("click", async () => {
          if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

          try {
            const res = await fetch(`http://127.0.0.1:8080/posts/${postId}`, {
              method: "DELETE",
              headers: {
                Authorization: `Bearer ${token}`,
              },
            });

            if (res.ok) {
              alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
              window.location.href = "main.html";
            } else {
              alert("ì‚­ì œ ì‹¤íŒ¨!");
            }
          } catch (err) {
            alert("ì„œë²„ ì˜¤ë¥˜");
          }
        });

      // ìˆ˜ì •í•˜ê¸°
      document.getElementById("editBtn").addEventListener("click", () => {
        window.location.href = `update.html?id=${postId}&userid=${postUserId}`;
      });
      console.log("URL id:", postId);
      console.log("Local token:", localStorage.getItem("token"));
      console.log("Decoded token:", myInfo);

      loadDetail();
    </script>
  </body>
</html>
