<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>메인 페이지 - 게시판</title>
    <style>
      /* 기본 스타일 재설정 및 폰트 */
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background: #f4f6f9; /* 밝고 현대적인 배경 */
        color: #333;
        line-height: 1.6;
      }

      /* 상단 네비게이션 바 */
      .navbar {
        background: #007bff; /* 전문적인 블루 */
        color: #fff;
        padding: 15px 5%; /* % 단위 패딩 사용 */
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* 깊은 그림자 */
      }
      .nav-left {
        display: flex;
        gap: 30px;
      }
      .nav-left a {
        color: white;
        text-decoration: none;
        font-size: 16px;
        font-weight: 500;
        transition: color 0.3s ease;
      }
      .nav-left a:hover {
        color: #c0deff;
      }
      .logout-btn {
        color: white;
        cursor: pointer;
        font-size: 14px;
        padding: 8px 15px;
        border: 1px solid rgba(255, 255, 255, 0.5);
        border-radius: 6px;
        transition: background 0.3s ease, border-color 0.3s ease;
      }
      .logout-btn:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.8);
      }

      /* 검색 박스 스타일 */
      .search-wrapper {
        max-width: 760px; /* 컨테이너와 비슷한 최대 폭 */
        width: 90%;
        margin: 30px auto;
        display: flex;
        gap: 10px;
        background: #ffffff;
        padding: 15px 20px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        align-items: center;
        transition: box-shadow 0.3s ease;
      }
      .search-wrapper:hover {
        box-shadow: 0 6px 20px rgba(0, 123, 255, 0.2);
      }

      /* 검색 input */
      #searchInput {
        flex: 1;
        padding: 12px 16px;
        border: 1px solid #ddd;
        outline: none;
        font-size: 16px;
        color: #333;
        background: #f7f9fc;
        border-radius: 8px;
        transition: border-color 0.3s ease, background 0.3s ease;
      }
      #searchInput:focus {
        border-color: #007bff;
        background: #fff;
      }

      /* 검색 버튼 */
      #searchBtn {
        padding: 12px 22px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: background 0.3s ease, transform 0.2s ease;
        box-shadow: 0 3px 8px rgba(0, 123, 255, 0.3);
      }
      #searchBtn:hover {
        background: #0056b3;
        transform: translateY(-1px);
      }
      #searchBtn:active {
        transform: scale(0.98);
      }

      /* 게시판 컨테이너 */
      .container {
        max-width: 800px;
        width: 90%; /* 일정한 비율 */
        margin: 40px auto;
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      }

      /* 개별 게시글 스타일 */
      .post {
        margin-bottom: 25px;
        padding: 20px;
        border: 1px solid #e9ecef; /* 부드러운 테두리 */
        border-radius: 10px;
        background-color: #ffffff;
        transition: box-shadow 0.3s ease, transform 0.3s ease;
      }
      .post:hover {
        box-shadow: 0 8px 16px rgba(0, 123, 255, 0.15); /* 호버 시 강조 */
        transform: scale(1.01); /* 살짝 커지는 애니메이션 */
      }

      .post-title {
        font-size: 22px;
        font-weight: 700;
        color: #007bff;
        margin-bottom: 10px;
        border-left: 5px solid #007bff;
        padding-left: 15px;
        line-height: 1.2;
      }

      .post-content {
        font-size: 15px;
        line-height: 1.7;
        color: #555;
        padding: 5px 0 10px 0;
      }

      /* 하단 작성 버튼 래퍼 */
      .write-btn-wrapper {
        text-align: center;
        margin-top: 50px;
        margin-bottom: 50px;
      }

      /* 작성 버튼 */
      .write-btn {
        padding: 15px 30px;
        font-size: 18px;
        font-weight: bold;
        background: #28a745; /* 산뜻한 초록색 */
        color: #fff;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        box-shadow: 0 6px 15px rgba(40, 167, 69, 0.4);
        transition: background 0.3s ease, transform 0.2s ease;
      }

      .write-btn:hover {
        background: #1e7e34;
        transform: translateY(-2px);
      }

      .detail-btn {
        margin-top: 15px;
        padding: 10px 18px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        float: right;
        font-size: 14px;
        font-weight: 600;
        transition: background 0.3s ease;
      }

      .detail-btn:hover {
        background: #0056b3;
      }

      /* 미디어 쿼리 - 작은 화면 대응 */
      @media (max-width: 768px) {
        .navbar {
          padding: 15px 20px;
        }
        .container,
        .search-wrapper {
          width: 95%; /* 더 넓게 사용 */
          margin-left: auto;
          margin-right: auto;
        }
        .search-wrapper {
          flex-direction: column; /* 세로 배열 */
        }
        #searchInput,
        #searchBtn {
          width: 100%; /* 너비 전체 사용 */
          margin: 5px 0;
        }
        #searchBtn {
          order: 2; /* 버튼이 타이틀, 텍스트 박스 아래에 위치 */
        }
        .post-title {
          font-size: 18px;
          padding-left: 10px;
        }
        .post-content {
          font-size: 14px;
        }
      }
    </style>
  </head>

  <body>
    <header id="header">
      <div class="navbar">
        <div class="nav-left">
          <a href="main.html">게시판</a>
          <a href="write.html">작성하기</a>
        </div>
        <div class="logout-btn" id="logoutBtn">로그아웃</div>
      </div>
    </header>
    <div class="search-wrapper">
      <input type="text" id="searchInput" placeholder="제목 또는 작성자 검색" />
      <button id="searchBtn">검색</button>
    </div>
    <div class="container" id="postList"></div>

    <div class="write-btn-wrapper">
      <button class="write-btn" onclick="location.href='write.html'">
        새 글 작성하기
      </button>
    </div>
    <script>
      document
        .getElementById("logoutBtn")
        .addEventListener("click", async () => {
          try {
            const res = await fetch("http://127.0.0.1:8080/auth/logout", {
              method: "POST",
            });
            if (res.ok) {
              document.getElementById("header").remove();
              localStorage.removeItem("token");
              window.location.href = "login.html";
            } else {
              alert("로그아웃 실패");
            }
          } catch (err) {
            console.error(err);
            alert("서버 오류");
          }
        });

      document.addEventListener("DOMContentLoaded", () => {
        const postListContainer = document.getElementById("postList");
        const searchBtn = document.getElementById("searchBtn");
        const searchInput = document.getElementById("searchInput");

        let allPosts = [];

        async function loadPosts() {
          try {
            const res = await fetch("http://127.0.0.1:8080/posts");
            const data = await res.json();
            allPosts = data.posts; // 전체 저장
            renderPosts(allPosts);
          } catch (err) {
            console.error("게시글 로드 오류:", err);
          }
        }

        function renderPosts(posts) {
          postListContainer.innerHTML = "";

          if (posts.length === 0) {
            postListContainer.innerHTML =
              '<div style="text-align:center; color:#888;">검색 결과가 없습니다.</div>';
            return;
          }

          posts.forEach((post) => {
            const postElement = document.createElement("div");
            postElement.className = "post";

            const date = new Date(post.createAt).toLocaleDateString("ko-KR");

            postElement.innerHTML = `
        <div class="post-title">${post.textTitle}
          <span style="font-size:14px; color:#aaa; margin-left:10px;">
            by ${post.userid} | ${date}
          </span>
        </div>
        <div class="post-content">${post.text}</div>
        <button class="detail-btn" onclick="location.href='detail.html?id=${post.id}'">자세히보기</button>
      `;

            postListContainer.appendChild(postElement);
          });
        }

        searchBtn.addEventListener("click", () => {
          const keyword = searchInput.value.trim().toLowerCase();

          const filtered = allPosts.filter((post) => {
            return (
              post.textTitle.toLowerCase().includes(keyword) ||
              post.userid.toLowerCase().includes(keyword)
            );
          });

          renderPosts(filtered);
        });
        searchInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            searchBtn.click();
          }
        });
        loadPosts();
      });
    </script>
  </body>
</html>
